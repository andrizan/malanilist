<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
		integrity="sha256-YvdLHPgkqJ8DVUxjjnGVlMMJtNimJ6dYkowFFvp4kKs=" crossorigin="anonymous">

	<title>Anime List</title>
	<style>
		html {
			scroll-behavior: smooth;
		}

		.bg-loader {
			background-color: #ffffff;
			width: 100%;
			height: 100%;
			position: fixed;
			z-index: 99;
		}

		.loader {
			border: 16px solid #f3f3f3;
			border-radius: 50%;
			border-top: 16px solid #3498db;
			width: 120px;
			height: 120px;
			-webkit-animation: spin 2s linear infinite;
			/* Safari */
			animation: spin 2s linear infinite;
			margin-bottom: 20px;
		}

		/* Safari */
		@-webkit-keyframes spin {
			0% {
				-webkit-transform: rotate(0deg);
			}

			100% {
				-webkit-transform: rotate(360deg);
			}
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		#menu {
			z-index: 9;
			background-color: #f3f3f3;
			padding: 20px 20px;
			position: fixed;
			width: 300px;
			border: 5px solid #3498db;
			border-top: 0;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/vue@3.2.31/dist/vue.global.prod.js"
		integrity="sha256-2ndwnHC+N2Yt4HwOAdoyAb6R6u9Ddt+R3TBGij6U35Q=" crossorigin="anonymous"></script>
</head>

<body>
	<div id="app">
		<div v-if="loading" class="bg-loader">
			<center style="margin-top: 15%;">
				<div class="loader"></div>
				<strong style="color: rgb(255, 0, 0);">
					{{message}}
				</strong>
				</center>
		</div>

		<div v-else>
			<!-- request finished -->
		</div>
		<div class="container">
			<div class="row" id="menu">
				<ul>
					<li>
						<a href="#curreSeas">
							<h4>Current Season</h4>
						</a>
					</li>
					<li>
						<a href="#upcomSeas">
							<h4>Upcoming Season</h4>
						</a>
					</li>
				</ul>
			</div>
			<div class="row" style="padding-top: 130px;">
				<div class="col-md-12">
					<h1 class="display-4" id="curreSeas">Current Season</h1>
				</div>
				<div class="table-responsive">
					<div class="col-md-12">
						<table class="table table-bordered table-striped table-hover">
							<thead>
								<tr>
									<th>No.</th>
									<th>Title</th>
									<th>Type</th>
									<th>Source</th>
									<th>Release</th>
									<th>Episodes</th>
									<th>Studios</th>
									<th>Members</th>
									<th>Status</th>
								</tr>
							</thead>
							<tbody>
								<tr v-for="(val,idx) in currentData">
									<td class="text-center">{{ (idx+1)+"." }}</td>
									<td>
										<a :href="val.url" target="_blank" style="text-decoration: none" title="Open in myanimelist.net">{{
											val.title }}</a>
									</td>
									<td class="text-center">{{ val.type }}</td>
									<td class="text-center">{{ val.source }}</td>
									<td class="text-center">{{ date(val.aired.from) }}</td>
									<td class="text-center">{{ val.episodes }}</td>
									<td class="text-center">
										<a v-for="(studio, i) in val.studios" :href="(studio) ? studio.url : '' " target="_blank" style="text-decoration:none;"
											title="Open in myanimelist.net">
											{{ (studio) ? (i>0) ? " & " + studio.name : studio.name :'' }}
										</a>
									</td>
									<td class="text-center">{{ numberWithCommas(val.members) }}</td>
									<td class="text-center">{{ val.status }}</td>
								</tr>
							</tbody>
						</table>
						</div>
						</div>
						</div>
						<hr>
						<div class="row">
							<div class="col-md-12">
								<h1 class="display-4" id="upcomSeas">Upcoming Season</h1>
							</div>
							<div class="table-responsive">
								<div class="col-md-12">
									<table class="table table-bordered table-striped table-hover">
										<thead>
											<tr>
												<th>No.</th>
												<th>Title</th>
												<th>Type</th>
												<th>Source</th>
												<th>Release</th>
									<th>Studios</th>
									<th>Members</th>
								</tr>
								</thead>
								<tbody>
									<tr v-for="(valu,idxx) in upcomingData">
									<td class="text-center">{{ (idxx+1) }}.</td>
									<td>
										<a :href="valu.url" target="_blank" style="text-decoration: none" title="Open myanimelist.net">{{
											valu.title }}</a>
									</td>
									<td class="text-center">{{ valu.type }}</td>
									<td class="text-center">{{ valu.source }}</td>
									<td class="text-center">{{ date(valu.aired.from) }}</td>
									<td class="text-center">
										<a v-for="(studio, i) in valu.studios" :href="(studio) ? studio.url : '' " target="_blank"
											style="text-decoration:none;" title="Open in myanimelist.net">
											{{ (studio) ? (i>0) ? " & " + studio.name : studio.name :'' }}
										</a>
									</td>
									<td class="text-center">{{ numberWithCommas(valu.members) }}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<p>
				&copy;{{new Date().getFullYear()}}
				<a href="https://github.com/andrizan/" target="_blank">andrizan</a>.
				Source Data : <a href="https://jikan.moe/" target="_blank">JIKAN V4</a>
			</p>
		</div>
	</div>

	<script>
			Vue.createApp({
				data() {
					return {
						upcomingData: "",
						currentData: "",
					loading: false,
					message: "Terdapat limitasi dalam penggunaan API. Tunggu sampai loading selesai, reload browser jika data tidak muncul."
				}
			},
			created: function () {
				this.upcoming();
				this.current();
			},
			// Methods are functions that mutate state and trigger updates.
			// They can be bound as event listeners in templates.
			methods: {
				getData: async function (url) {
					this.loading = true
					var result = await fetch(url)
					return result.json()
				},

				current: async function () {
					var vm = this;

					var result = [];

					get = await this.getData('https://api.jikan.moe/v4/seasons/now')
					result = result.concat(get.data);

					const timer = ms => new Promise(res => setTimeout(res, ms))
					if (get.pagination.has_next_page) {
						for (var i = 2; i <= get.pagination.last_visible_page; i++) {
							var rawResponse = await this.getData('https://api.jikan.moe/v4/seasons/now?page=' + i)
							result = result.concat(rawResponse.data);
							await timer(500);
						}
					}
					vm.currentData = result;
				},

				upcoming: async function () {
					var vm = this;

					var result = [];

					get = await this.getData('https://api.jikan.moe/v4/seasons/upcoming')
					result = result.concat(get.data);

					var total_page = get.pagination.last_visible_page

					const timer = ms => new Promise(res => setTimeout(res, ms))

					if (get.pagination.has_next_page) {
						for (var i = 2; i <= total_page; i++) {
							var rawResponse = await this.getData('https://api.jikan.moe/v4/seasons/upcoming?page=' + i)
							result = result.concat(rawResponse.data);
							await timer(500);
						}
					}
					vm.upcomingData = result;
					this.loading = false
				},

				date: function (x) {
					if (x == null) {
						return null
					}

					var yourDate = new Date(x);
					const offset = yourDate.getTimezoneOffset()
					yourDate = new Date(yourDate.getTime() - (offset * 60 * 1000))
					return yourDate.toISOString().split('T')[0]
				},
				numberWithCommas: function (x) {
					if (x == null) {
						return null
					}
					return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
				},
			},
		}).mount('#app')
	</script>
</body>

</html>
